<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#14b8a6">
<link rel="icon" href="ikon-512.png">
<title>Data Cabang - Admin Pusat</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<style>
  :root{
    --primary:#14b8a6;      /* Biru kehijauan futuristik */
    --accent:#fb923c;       /* Oranye aksen */
    --bg:#f3f4f6;           /* Latar belakang cerah */
    --card:#ffffff;         /* Card putih bersih */
    --border:#d1d5db;       /* Border abu lembut */
    --text:#1f2937;         /* Teks utama gelap lembut */
    --muted:#f3f3f3;        /* Teks sekunder */
    --glow:0 0 20px rgba(20,184,166,.2);
  }

body {
  margin: 0;
  font-family: 'Nunito', sans-serif;
  background:
    radial-gradient(circle at top left, rgba(20,184,166,.15), transparent 50%),
    radial-gradient(circle at bottom right, rgba(251,146,60,.1), transparent 50%),
    linear-gradient(135deg, #f3f4f6, #e0f2fe);
    min-height:100vh;
    padding-bottom: 50px;
}
  /* ================= GENERAL ================= */
  * {
    box-sizing: border-box;
    font-family: 'Inter', sans-serif;
    -webkit-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    outline: none;
  }

  /* Header */
  .header {
    background: var(--primary);
    height: 120px;
    border-bottom-left-radius: 30px;
    border-bottom-right-radius: 30px;
    position: relative;
  }
  
  /* Container */
  .container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 20px;
    position: relative;
    z-index: 1;
  }
  /* Fade-in container */
  .container {
    opacity: 0;
    transform: translateY(20px); /* sedikit turun untuk efek */
    transition: opacity 0.5s ease, transform 0.5s ease;
  }
  
  .container.show {
    opacity: 1;
    transform: translateY(0);
  }  
  
  /* Card */
  .card1 {
    background: var(--card);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    position: relative;
    top: -40px; /* Card menimpa header sedikit */
  }
  .card1 h1 {
    margin-top: 0;
    color: var(--primary);
    font-size: 30px;
    text-align: center;
  }
  .card {
    background: var(--card);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    position: relative;
    top: -40px; /* Card menimpa header sedikit */
  }
  .card h1 {
    margin-top: 0;
    color: var(--primary);
    font-size: 30px;
    text-align: center;
  }
  .card:hover{
    background:var(--primary);
    color:white;
    box-shadow:var(--glow);
  }
  
  .bold{font-weight:bold}
  .small{color:var(--text);font-size:12px}
  
  button{
    padding:10px;
    border:none;
    border-radius:8px;
    font-weight:bold;
    width:100%;
    margin-top:6px;
    cursor:pointer;
  }
  .btnSave{background:var(--primary);color:white}
  .btnCancel{background:#e5e5e5;color:black}
  .btnDelete{background:var(--accent);color:white}
  
  /* POPUP */
/* POPUP */
.popup-bg{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:99999999;
  overflow-y:auto; /* memungkinkan scroll jika tinggi popup > layar */
  padding:20px;    /* agar popup tidak menempel layar */
}

.popupBox{
  background:var(--card);
  padding:14px;
  border-radius:12px;
  width:90%;
  max-width:420px;
  max-height:90vh;   /* maksimal tinggi 90% viewport */
  overflow-y:auto;   /* scroll jika isi melebihi max-height */
  box-shadow:var(--glow);
}
  input{
    width:100%;
    padding:8px;
    margin:4px 0;
    border-radius:8px;
    border:1px solid var(--border);
  }
  .row{
    display:flex;gap:8px;
    justify-content:space-between
  }
  /* NAVIGASI BAWAH */
  .bottomNav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #fff;
    display: flex;
    justify-content: space-around;
    padding: 10px 0;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    z-index: 1000;
    border-top-left-radius: 20px;
    border-top-right-radius: 20px;
  }
  
  .navItem {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: var(--primary);
    text-decoration: none;
    font-size: 12px;
  }
  
  .navIcon {
    background: var(--muted);
    border-radius: 50%;
    padding: 8px;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    transition: all 0.2s ease;
  }
  
  .navIcon svg {
    width: 20px;
    height: 20px;
    stroke: var(--primary);
  }
  
  /* NAVIGASI BAWAH AKTIF */
  .navItem.active .navIcon {
    background: var(--accent);
  }
  
  .navItem.active span {
    color: var(--accent);
  }
  
  /* Hover tetap */
  .navItem:hover .navIcon {
    background: var(--accent);
  }
  
  .navItem:hover span {
    color: var(--accent);
  }
</style>
</head>
<body>
<div class="header"></div>
<div class="container">
  <div class="card1">
    <h1>Laporan Harian Admin</h1>
    <div style="margin-bottom:10px;">
    <div class="row" style="gap:10px; flex-wrap:wrap;">
      <div style="flex:1; min-width:120px;" >
        <input type="date" id="filterStart">
      </div>
      <div style="flex:1; min-width:120px;">
        <input type="date" id="filterEnd">
      </div>
      <div style="flex:1; min-width:120px; align-self:end;">
        <button onclick="applyFilter()" style="width:100%;">Filter</button>
      </div>
    </div>
  </div>
  </div>
  <div id="list"></div>
</div>
<!-- POPUP EDIT -->
<div id="editPopup" class="popup-bg">
  <div class="popupBox">
    <small>Tanggal Produksi</small><input id="eTanggal" type="date">
    <small>Loyang Produksi</small><input id="eLoyang">
    <small>Galon Air</small><input id="eGalon">
    <small>Fee Admin Cabang</small><input id="eFee">
    <small>Saldo Akhir Cabang</small><input id="eSaldo">

    <hr>

    <small>Jumlah Klien</small><input id="eKlien">
    <small>Pembayaran dari Klien</small><input id="ePayKlien">
    <small>Jumlah Sales</small><input id="eSales">
    <small>Pembayaran ke Sales</small><input id="ePaySales">

    <hr>

    <small>Total Profit / Uang Masuk</small><input id="eTotalProfit">

    <div class="row">
      <button class="btnSave" onclick="saveEdit()">Simpan</button>
      <button class="btnCancel" onclick="closeEdit()">Batal</button>
    </div>
    <button class="btnDelete" onclick="confirmDelete()">Hapus Data</button>
  </div>
</div>

<!-- POPUP DELETE KONFIRMASI -->
<div id="deletePopup" class="popup-bg">
  <div class="popupBox">
    <p>‚ö†Ô∏è Apakah kamu yakin ingin menghapus data ini?</p>
    <div class="row">
      <button class="btnCancel" onclick="closeDelete()">Batal</button>
      <button class="btnDelete" id="deleteConfirmBtn">Hapus</button>
    </div>
  </div>
</div>

<!-- NAVIGASI BAWAH -->
<div class="bottomNav">
  <a href="index.html" class="navItem">
    <div class="navIcon">
      <!-- Home SVG -->
      <svg width="36" viewBox="0 0 1664 1312" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M1408 768v480q0 26-19 45t-45 19H960V928H704v384H320q-26 0-45-19t-19-45V768q0-1 .5-3t.5-3l575-474l575 474q1 2 1 6zm223-69l-62 74q-8 9-21 11h-3q-13 0-21-7L832 200L140 777q-12 8-24 7q-13-2-21-11l-62-74q-8-10-7-23.5T37 654L756 55q32-26 76-26t76 26l244 204V64q0-14 9-23t23-9h192q14 0 23 9t9 23v408l219 182q10 8 11 21.5t-7 23.5z" fill="currentColor"/></svg>
    </div>
    <span>Home</span>
  </a>
  <a href="datacabang.html" class="navItem">
    <div class="navIcon">
      <!-- Home SVG -->
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
        <path d="M12 11.993a.75.75 0 0 0-.75.75v.006c0 .414.336.75.75.75h.006a.75.75 0 0 0 .75-.75v-.006a.75.75 0 0 0-.75-.75H12ZM12 16.494a.75.75 0 0 0-.75.75v.005c0 .414.335.75.75.75h.005a.75.75 0 0 0 .75-.75v-.005a.75.75 0 0 0-.75-.75H12ZM8.999 17.244a.75.75 0 0 1 .75-.75h.006a.75.75 0 0 1 .75.75v.006a.75.75 0 0 1-.75.75h-.006a.75.75 0 0 1-.75-.75v-.006ZM7.499 16.494a.75.75 0 0 0-.75.75v.005c0 .414.336.75.75.75h.005a.75.75 0 0 0 .75-.75v-.005a.75.75 0 0 0-.75-.75H7.5ZM13.499 14.997a.75.75 0 0 1 .75-.75h.006a.75.75 0 0 1 .75.75v.005a.75.75 0 0 1-.75.75h-.006a.75.75 0 0 1-.75-.75v-.005ZM14.25 16.494a.75.75 0 0 0-.75.75v.006c0 .414.335.75.75.75h.005a.75.75 0 0 0 .75-.75v-.006a.75.75 0 0 0-.75-.75h-.005ZM15.75 14.995a.75.75 0 0 1 .75-.75h.005a.75.75 0 0 1 .75.75v.006a.75.75 0 0 1-.75.75H16.5a.75.75 0 0 1-.75-.75v-.006ZM13.498 12.743a.75.75 0 0 1 .75-.75h2.25a.75.75 0 1 1 0 1.5h-2.25a.75.75 0 0 1-.75-.75ZM6.748 14.993a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1-.75-.75Z" />
        <path fill-rule="evenodd" d="M18 2.993a.75.75 0 0 0-1.5 0v1.5h-9V2.994a.75.75 0 1 0-1.5 0v1.497h-.752a3 3 0 0 0-3 3v11.252a3 3 0 0 0 3 3h13.5a3 3 0 0 0 3-3V7.492a3 3 0 0 0-3-3H18V2.993ZM3.748 18.743v-7.5a1.5 1.5 0 0 1 1.5-1.5h13.5a1.5 1.5 0 0 1 1.5 1.5v7.5a1.5 1.5 0 0 1-1.5 1.5h-13.5a1.5 1.5 0 0 1-1.5-1.5Z" clip-rule="evenodd" />
      </svg>

    </div>
    <span>Laporan</span>
  </a>
  <a href="helper.html" class="navItem">
    <div class="navIcon">
      <!-- Edit SVG -->
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
        <path d="M5.85 3.5a.75.75 0 0 0-1.117-1 9.719 9.719 0 0 0-2.348 4.876.75.75 0 0 0 1.479.248A8.219 8.219 0 0 1 5.85 3.5ZM19.267 2.5a.75.75 0 1 0-1.118 1 8.22 8.22 0 0 1 1.987 4.124.75.75 0 0 0 1.48-.248A9.72 9.72 0 0 0 19.266 2.5Z" />
        <path fill-rule="evenodd" d="M12 2.25A6.75 6.75 0 0 0 5.25 9v.75a8.217 8.217 0 0 1-2.119 5.52.75.75 0 0 0 .298 1.206c1.544.57 3.16.99 4.831 1.243a3.75 3.75 0 1 0 7.48 0 24.583 24.583 0 0 0 4.83-1.244.75.75 0 0 0 .298-1.205 8.217 8.217 0 0 1-2.118-5.52V9A6.75 6.75 0 0 0 12 2.25ZM9.75 18c0-.034 0-.067.002-.1a25.05 25.05 0 0 0 4.496 0l.002.1a2.25 2.25 0 1 1-4.5 0Z" clip-rule="evenodd" />
      </svg>


    </div>
    <span>Helper</span>
  </a>
  <a href="datamemeber.html" class="navItem">
    <div class="navIcon">
      <!-- Member / User SVG -->
       <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
        <path fill-rule="evenodd" d="M8.25 6.75a3.75 3.75 0 1 1 7.5 0 3.75 3.75 0 0 1-7.5 0ZM15.75 9.75a3 3 0 1 1 6 0 3 3 0 0 1-6 0ZM2.25 9.75a3 3 0 1 1 6 0 3 3 0 0 1-6 0ZM6.31 15.117A6.745 6.745 0 0 1 12 12a6.745 6.745 0 0 1 6.709 7.498.75.75 0 0 1-.372.568A12.696 12.696 0 0 1 12 21.75c-2.305 0-4.47-.612-6.337-1.684a.75.75 0 0 1-.372-.568 6.787 6.787 0 0 1 1.019-4.38Z" clip-rule="evenodd" />
        <path d="M5.082 14.254a8.287 8.287 0 0 0-1.308 5.135 9.687 9.687 0 0 1-1.764-.44l-.115-.04a.563.563 0 0 1-.373-.487l-.01-.121a3.75 3.75 0 0 1 3.57-4.047ZM20.226 19.389a8.287 8.287 0 0 0-1.308-5.135 3.75 3.75 0 0 1 3.57 4.047l-.01.121a.563.563 0 0 1-.373.486l-.115.04c-.567.2-1.156.349-1.764.441Z" />
      </svg>

    </div>
    <span>Member</span>
  </a>
</div>
<script>
// Firebase config
firebase.initializeApp({
  apiKey:"AIzaSyCl13_a4x-BQnWNUjf9JOQX1DKc-HxLBys",
  authDomain:"klien-39696.firebaseapp.com",
  projectId:"klien-39696"
});

const auth=firebase.auth();
const db=firebase.firestore();
const list=document.getElementById("list");

function rupiah(n){ return "Rp "+(Number(n)||0).toLocaleString("id-ID"); }
function formatTanggal(str){
  if(!str) return "-";
  return new Date(str).toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"});
}

// ================= AUTH ADMIN PUSAT =================
auth.onAuthStateChanged(async u=>{
  if(!u) return location.href="loginadmin.html";
  const doc = await db.collection("admins").doc(u.uid).get();
  if(!doc.exists || doc.data().role!=="admin") return location.href="loginadmin.html";
  loadAllData();
});

// ================= LOAD DATA =================
let allData = [];
async function loadAllData(){
  const snap = await db.collection("inputAdmin").orderBy("tanggal","desc").get();
  list.innerHTML="";
  allData=[];
  snap.forEach(d=>{
    const data = {...d.data(), docId: d.id};
    allData.push(data);

    const div=document.createElement("div");
    div.className="card";
    div.onclick=()=>openEdit(data.docId,data);

    div.innerHTML=`
      <div class="bold">üìÖ ${formatTanggal(data.tanggal)}</div>
      <div class="small">Cabang: ${data.adminNama} (${data.adminID})</div>
      <hr>
      <div>Loyang: <b>${data.loyang}</b></div>
      <div>Galon: <b>${data.galon}</b></div>
      <div>Fee: <b>${data.fee}</b></div>
      <div>Saldo: <b>${data.saldo}</b></div>
      <div>Jumlah Klien: <b>${data.klien}</b></div>
      <div>Pembayaran Klien: <b>${rupiah(data.pembayaranKlien)}</b></div>
      <div>Jumlah Sales: <b>${data.sales}</b></div>
      <div>Pembayaran Sales: <b>${rupiah(data.pembayaranSales)}</b></div>
      <hr>
      <div class="bold">Total Profit: ${rupiah(data.totalProfit)}</div>
    `;
    list.appendChild(div);
  });
}
function applyFilter(){
  const start = document.getElementById("filterStart").value;
  const end = document.getElementById("filterEnd").value;

  if(!start && !end){
    loadAllData(); // tanpa filter
    return;
  }

  let query = db.collection("inputAdmin").orderBy("tanggal","desc");

  if(start && end){
    query = query.where("tanggal", ">=", start).where("tanggal", "<=", end);
  } else if(start){
    query = query.where("tanggal", ">=", start);
  } else if(end){
    query = query.where("tanggal", "<=", end);
  }

  query.get().then(snap=>{
    list.innerHTML="";
    allData=[];
    snap.forEach(d=>{
      const data = {...d.data(), docId: d.id};
      allData.push(data);

      const div=document.createElement("div");
      div.className="card";
      div.onclick=()=>openEdit(data.docId,data);

      div.innerHTML=`
        <div class="bold">üìÖ ${formatTanggal(data.tanggal)}</div>
        <div class="small">Cabang: ${data.adminNama} (${data.adminID})</div>
        <hr>
        <div>Loyang: <b>${data.loyang}</b></div>
        <div>Galon: <b>${data.galon}</b></div>
        <div>Fee: <b>${data.fee}</b></div>
        <div>Saldo: <b>${data.saldo}</b></div>
        <div>Jumlah Klien: <b>${data.klien}</b></div>
        <div>Pembayaran Klien: <b>${rupiah(data.pembayaranKlien)}</b></div>
        <div>Jumlah Sales: <b>${data.sales}</b></div>
        <div>Pembayaran Sales: <b>${rupiah(data.pembayaranSales)}</b></div>
        <hr>
        <div class="bold">Total Profit: ${rupiah(data.totalProfit)}</div>
      `;
      list.appendChild(div);
    });
  });
}

// ================= EDIT POPUP =================
let currentDocId=null;
function openEdit(id,data){
  currentDocId=id;
  eTanggal.value=data.tanggal||"";
  eLoyang.value=data.loyang||0;
  eGalon.value=data.galon||0;
  eFee.value=data.fee||0;
  eSaldo.value=data.saldo||0;
  eKlien.value=data.klien||0;
  ePayKlien.value=data.pembayaranKlien||0;
  eSales.value=data.sales||0;
  ePaySales.value=data.pembayaranSales||0;
  eTotalProfit.value=data.totalProfit||0;
  editPopup.style.display="flex";
}
function closeEdit(){ editPopup.style.display="none"; }

// ================= SAVE UPDATE =================
async function saveEdit(){
  if(!currentDocId) return;
  const newData={
    tanggal:eTanggal.value,
    loyang:Number(eLoyang.value),
    galon:Number(eGalon.value),
    fee:Number(eFee.value),
    saldo:Number(eSaldo.value),
    klien:Number(eKlien.value),
    pembayaranKlien:Number(ePayKlien.value),
    sales:Number(eSales.value),
    pembayaranSales:Number(ePaySales.value),
    totalProfit:Number(eTotalProfit.value)
  };
  try{
    await db.collection("inputAdmin").doc(currentDocId).update(newData);
    alert("‚úÖ Data berhasil diupdate");
    closeEdit();
    loadAllData();
  }catch(e){
    console.error(e);
    alert("‚ùå Gagal update data");
  }
}

// ================= DELETE DATA =================
let deleteId = null;
function confirmDelete(){
  closeEdit();
  deleteId = currentDocId;
  document.getElementById("deletePopup").style.display="flex";
}
function closeDelete(){
  deleteId=null;
  document.getElementById("deletePopup").style.display="none";
}
document.getElementById("deleteConfirmBtn").onclick=async()=>{
  if(!deleteId) return;
  try{
    await db.collection("inputAdmin").doc(deleteId).delete();
    alert("‚úÖ Data berhasil dihapus");
    closeDelete();
    loadAllData();
  }catch(e){
    console.error(e);
    alert("‚ùå Gagal hapus data");
  }
}
  // ==========================
  // SET HALAMAN AKTIF NAVIGASI
  // ==========================
  const navLinks = document.querySelectorAll('.navItem');
  const currentPage = window.location.pathname.split("/").pop(); // ambil nama file saat ini
  
  navLinks.forEach(link => {
    const href = link.getAttribute('href');
    if(href === currentPage){
      link.classList.add('active'); // tandai halaman aktif
    }
  
    // Optional: smooth hover klik (langsung ke halaman)
    link.addEventListener('click', () => {
      navLinks.forEach(l => l.classList.remove('active'));
      link.classList.add('active');
    });
  });
  //transisi
  document.addEventListener('DOMContentLoaded', () => {
    const container = document.querySelector('.container');
    setTimeout(() => {
      container.classList.add('show');
    }, 50); // delay kecil supaya transisi terlihat
  });
</script>
</body>
</html>